<div id="map-container">
  <!-- Left side - map -->
  <div id="map-area" role="main" aria-label="Interactive university map">
    <header id="map-header">
      <h1>University Navigation Map</h1>
      <div id="map-info">
        <span id="building-name" aria-live="polite">Loading...</span>
        <span id="floor-info">Floor: <span id="current-floor" aria-live="polite">-</span></span>
      </div>
    </header>

    <nav id="map-controls" aria-label="Map controls">
      <button id="zoom-in" class="md-fab" aria-label="Zoom in" title="Zoom in">+</button>
      <button id="zoom-out" class="md-fab" aria-label="Zoom out" title="Zoom out">−</button>
      <button id="reset-view" class="md-fab" aria-label="Reset view" title="Reset view">⌂</button>
    </nav>

    <div id="svg-container" role="img" aria-label="University map" tabindex="0">
      <div id="loading-indicator" aria-live="assertive">
        <div class="md-spinner" aria-hidden="true"></div>
        <span>Loading map...</span>
      </div>
      <div id="map-svg"></div>
    </div>

    <aside id="route-info" role="complementary" aria-labelledby="route-title" style="display: none;">
      <h3 id="route-title">Route</h3>
      <div id="route-details">
        <div id="route-distance" aria-live="polite">Distance: <span>0</span> m</div>
        <div id="route-steps" role="list" aria-label="Route steps"></div>
      </div>
      <button id="clear-route" class="md-button md-button-outlined" aria-describedby="route-title">Clear route</button>
    </aside>
  </div>

  <!-- Right side - tools panel -->
  <aside id="tools-panel" role="complementary" aria-label="Tools panel">

    <!-- Floor selector -->
    <section class="md-card" aria-labelledby="floor-selector-title">
      <h2 id="floor-selector-title">Floors</h2>
      <div id="floor-buttons" class="md-button-group" role="radiogroup" aria-labelledby="floor-selector-title">
        <!-- Floors will be added dynamically -->
      </div>
    </section>

    <!-- Room search -->
    <section class="md-card" aria-labelledby="room-search-title">
      <h2 id="room-search-title">Room Search</h2>
      
      <div id="search-input-container" style="position: relative;">
        <div class="md-text-field">
          <label for="search-input">Room name or number</label>
          <input 
            type="text" 
            id="search-input" 
            placeholder="Enter room name or number"
            autocomplete="off"
            aria-describedby="search-help"
          />
        </div>
        <button id="search-button" class="md-button md-button-contained" style="width: 100%; margin-top: 8px;">
          Search
        </button>
        <div id="search-autocomplete" role="listbox" aria-label="Search suggestions"></div>
      </div>

      <div class="md-text-field">
        <label for="category-select">Category</label>
        <select id="category-select" aria-describedby="room-search-title">
          <option value="all">All categories</option>
          <option value="laboratory">Laboratories</option>
          <option value="restroom">Restrooms</option>
          <option value="food-service">Food service</option>
          <option value="utility">Utility rooms</option>
          <option value="recreation">Recreation</option>
          <option value="workspace">Workspaces</option>
        </select>
      </div>

      <div id="search-results" role="region" aria-live="polite" aria-label="Search results">
        <!-- Search results -->
      </div>
      <span id="search-help" class="sr-only">Use search to find the rooms you need</span>
    </section>

    <!-- Navigation between rooms -->
    <section class="md-card" aria-labelledby="navigation-title">
      <h2 id="navigation-title">Navigation</h2>
      
      <div id="route-builder">
        <div class="md-text-field">
          <label for="from-select">From</label>
          <select id="from-select" aria-describedby="navigation-title">
            <option value="">Select starting room</option>
          </select>
        </div>

        <div class="md-text-field">
          <label for="to-select">To</label>
          <select id="to-select" aria-describedby="navigation-title">
            <option value="">Select destination room</option>
          </select>
        </div>

        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button id="build-route" class="md-button md-button-contained" style="flex: 1;">
            Build route
          </button>
          <button id="swap-route" class="md-button md-button-outlined" style="width: 48px;" 
                  aria-label="Swap starting and ending points" title="Swap">
            ⇅
          </button>
        </div>
      </div>

      <div id="quick-actions">
        <h3>Quick actions</h3>
        <button id="find-nearest-restroom" class="md-button md-button-text" style="width: 100%;">
          Nearest restroom
        </button>
      </div>
    </section>

    <!-- Selected room -->
    <section class="md-card" id="room-details" aria-labelledby="room-details-title" style="display: none;">
      <h2 id="room-details-title">Room details</h2>
      <div id="selected-room-info" aria-live="polite">
        <div id="room-name" style="font-size: 1rem; font-weight: 500; margin-bottom: 12px;"></div>
        <div id="room-category"></div>
        <div id="room-keywords"></div>
        <div id="room-access"></div>
      </div>
      <div id="room-actions" style="margin-top: 16px;">
        <button id="route-to-room" class="md-button md-button-contained" style="width: 100%; margin-bottom: 8px;">
          Route to this room
        </button>
        <button id="route-from-room" class="md-button md-button-outlined" style="width: 100%; margin-bottom: 8px;">
          Route from this room
        </button>
        <button id="highlight-room" class="md-button md-button-text" style="width: 100%;">
          Highlight room
        </button>
      </div>
    </section>

    <!-- System information -->
    <section class="md-card" aria-labelledby="system-info-title">
      <h2 id="system-info-title">System information</h2>
      <div id="system-status" role="status">
        <div>
          <span>Status:</span>
          <span id="connection-status" aria-live="polite">Connected</span>
        </div>
        <div>
          <span>Map:</span>
          <span id="current-map-name" aria-live="polite">-</span>
        </div>
        <div>
          <span>Rooms:</span>
          <span id="rooms-count" aria-live="polite">0</span>
        </div>
        <div>
          <span>Nodes:</span>
          <span id="nodes-count" aria-live="polite">0</span>
        </div>
      </div>
    </section>
  </aside>
</div>

<!-- Error modal -->
<div id="error-modal" role="dialog" aria-labelledby="error-title" aria-modal="true" style="display: none;">
  <div id="error-content">
    <h3 id="error-title">Error</h3>
    <p id="error-message" role="alert"></p>
    <button id="close-error" class="md-button md-button-contained" style="width: 100%;">
      Close
    </button>
  </div>
</div>

<!-- Context menu for rooms -->
<nav id="context-menu" role="menu" style="display: none;">
  <div id="context-room-name" role="presentation"></div>
  <button id="context-route-to" role="menuitem">Route here</button>
  <button id="context-route-from" role="menuitem">Route from here</button>
  <button id="context-room-info" role="menuitem">Detailed information</button>
</nav>

<script>
// Global variables for map functionality
window.mapConfig = {
  defaultMapId: '<%= defaultMapId %>',
  availableMaps: <%- JSON.stringify(availableMaps) %>,
  currentMapData: null,
  selectedRoom: null,
  currentRoute: null,
  zoomLevel: 1,
  panX: 0,
  panY: 0
};
</script>

<script src="/js/map-core.js"></script>
<script src="/js/map-ui.js"></script>
<script src="/js/map-navigation.js"></script>
<script src="/js/map-search.js"></script>